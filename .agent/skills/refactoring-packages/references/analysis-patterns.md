# パッケージ構造分析パターン

## 問題パターンの検出

### 1. 循環依存
```
検出パターン: A → B → C → A
解決策:
- 共通インターフェースの抽出
- 依存方向の反転（DIP適用）
- 中間層の導入
```

### 2. 神モジュール
```
兆候:
- 1ファイル500行以上
- 複数の責務を持つ
- 変更頻度が高い

解決策:
- 責務ごとに分割
- ドメイン境界で分離
```

### 3. 散在した関連機能
```
兆候:
- 関連機能が複数ディレクトリに分散
- 同一機能の変更で複数箇所を修正

解決策:
- 機能単位でのグループ化
- Vertical Slice構造への移行
```

### 4. 過度なネスト
```
兆候:
- 5階層以上のディレクトリ構造
- インポートパスが長い

解決策:
- フラット化
- モジュール境界の再定義
```

## 構造評価指標

| 指標 | 良好 | 要改善 |
|------|------|--------|
| ディレクトリ深度 | ≤4 | >4 |
| ファイル/ディレクトリ | ≤10 | >15 |
| 循環依存 | 0 | >0 |
| 外部公開率 | <30% | >50% |

## 言語別ベストプラクティス

### Rust
- mod.rs禁止（Rust 2018スタイル）
- `{name}/tests.rs`でテスト分離
- 1ファイル1公開型

### TypeScript/JavaScript
- barrel export（index.ts）の適切な使用
- 相対インポートの深さ制限

### Python
- `__init__.py`の肥大化防止
- 相対インポートの一貫性
